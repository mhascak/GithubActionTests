name: tooling-be.ownership-comment
# Controls when the workflow will run
on:
  pull_request:
    branches: [ "main" ]
    
env:
  CODEOWNER_SEARCH_COMMENT_PREFIX: 'Notifying code owners:'
  MY_GITHUB_TOKEN: ${{ secrets.ACTIONS_TOKEN }}
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DOTNET_VERSION: '6.0.x'
  BRANCH_NAME: ${{ github.head_ref || github.ref_name }} 
  
jobs:
  notify-comment:

    runs-on: ubuntu-latest
    steps:
  
      - name: API LIMIT BEFORE
        shell: pwsh
        run: |
          $response = & gh api rate_limit     	
          echo $response
          
          
      - name: Sparse checkout
        shell: bash
        run: |
          REPO="https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git"
          BRANCH="${GITHUB_REF/#refs\/heads\//}"

          # Following code is based on logs of actions/checkout@v, with sparseCheckout stuff inserted in the middle
          echo "Syncing repository: $GITHUB_REPOSITORY"
          echo "Working directory is '$(pwd)' GITHUB_WORKSPACE=$GITHUB_WORKSPACE BRANCH=$BRANCH"
          git version
          git init $GITHUB_WORKSPACE
          git remote add origin https://github.com/$GITHUB_REPOSITORY
          git config --local gc.auto 0
          # Now interesting part
          git config core.sparseCheckout true
          # Add here contents of sparse-checkout line by line
          echo "tools" >> .git/info/sparse-checkout
          # echo ... 
          git -c protocol.version=2 fetch --no-tags --prune --progress --depth=10 origin +${GITHUB_SHA}:refs/remotes/origin/${BRANCH}
          git checkout --progress --force -B $BRANCH refs/remotes/origin/$BRANCH
          
      - name: LS
        shell: pwsh
        run: tree
          
      - name: git
        run: |
          # setup the username and email. I tend to use 'GitHub Actions Bot' with no email by default
          git init
          git --version
          git config user.name 'mhascak'
          git config user.email 'martinhascak@gmail.com'
          
          git clone --filter=blob:none --sparse git@github.com:mhascak/GithubActionTests.git
          git sparse-checkout add tools
          
          git status

      - name: API LIMIT AFTER
        shell: pwsh
        run: |
          $response = & gh api rate_limit     	
          echo $response
